<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <!-- Impedisce lo zoom su mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Pacchetto Wellness - Trilussa Palace Hotel</title>
  <meta
    name="description"
    content="Richiedi un preventivo personalizzato per il tuo pacchetto wellness presso il Trilussa Palace Hotel. Scegli tra diverse opzioni Spa e Extra per un'esperienza di relax unica."
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    /* Definizione della palette di colori */
    :root {
      --primary-color: #6D4C41; /* Marrone scuro */
      --secondary-color: #8D6E63; /* Marrone chiaro */
      --accent-color: #FFA726; /* Arancione */
      --background-color: #f2efed; /* Aggiornato */
      --text-color: #333333; /* Grigio scuro */
      --price-bar-color: #8D6E63; /* Marrone chiaro */
      --button-color: #6D4C41; /* Marrone scuro */
      --button-hover-color: #8D6E63; /* Marrone chiaro */
      --input-border-color: #cccccc;
      --option-hover-bg: #e0e0e0;
      --modal-bg: rgba(0, 0, 0, 0.5);
      --spinner-color: #6D4C41;
    }

    /* Impostazioni base */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: 'Roboto', sans-serif;
      background: var(--background-color);
      overflow: hidden; /* Previene lo scorrimento complessivo */
    }

    /* Barra fissa con il totale */
    .price-bar {
      position: fixed; /* Fissa la barra in alto */
      top: 0;
      left: 0;
      width: 100%;
      background-color: var(--price-bar-color);
      color: white;
      padding: 12px 16px; /* Ridotto per mobile */
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      font-size: 1.4rem; /* Ridotto per mobile */
      z-index: 1000;
      font-weight: 700;
      text-align: center;
    }

    /* Contenitore principale */
    .container {
      margin: 60px auto 20px auto; /* Ridotto per mobile */
      width: 95%;
      max-width: 600px;
      padding: 10px; /* Ridotto per mobile */
      box-sizing: border-box;
      background: var(--background-color);
      display: flex;
      flex-direction: column;
      align-items: stretch; /* Allinea gli elementi per estensione */
      height: calc(100vh - 80px); /* Adatta l'altezza per riempire lo schermo meno la price-bar */
      overflow: hidden; /* Previene lo scorrimento interno */
    }

    .container h1 {
      color: var(--primary-color);
      font-size: 1.6rem; /* Ridotto per mobile */
      margin-top: 0;
      margin-bottom: 10px; /* Ridotto per mobile */
      font-weight: 700;
      text-align: center;
    }

    .container p {
      color: var(--text-color);
      font-size: 1rem; /* Ridotto per mobile */
      margin-bottom: 15px; /* Ridotto per mobile */
      text-align: center;
      word-wrap: break-word;
    }

    /* Sistemiamo i passaggi/step */
    .step {
      width: 100%;
      background: white;
      padding: 15px; /* Ridotto per mobile */
      border-radius: 12px; /* Ridotto per mobile */
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin-bottom: 15px; /* Ridotto per mobile */
      display: none; /* Nascondi tutti gli step inizialmente */
      flex-direction: column;
      overflow-y: auto; /* Permette lo scorrimento interno se necessario */
      transition: opacity 0.3s ease, transform 0.3s ease;
      opacity: 0;
      transform: translateX(100%);
    }
    .step.active {
      display: flex;
      opacity: 1;
      transform: translateX(0);
      z-index: 1;
    }

    .step-header {
      margin-bottom: 10px; /* Ridotto per mobile */
    }
    .step-header h2 {
      font-size: 1.1rem; /* Ridotto per mobile */
      color: var(--primary-color);
      margin: 0 0 10px 0; /* Ridotto per mobile */
      font-weight: 700;
      text-align: center;
    }

    /* Opzioni */
    .options, .extras, .time-slots {
      display: flex;
      flex-direction: column;
      gap: 10px; /* Ridotto per mobile */
      flex: 1; /* Permette di riempire lo spazio disponibile */
    }

    .option {
      display: flex;
      align-items: center;
      padding: 10px; /* Ridotto per mobile */
      border: 1px solid var(--input-border-color);
      border-radius: 10px; /* Ridotto per mobile */
      background: white;
      transition: background 0.3s ease, transform 0.3s ease;
      font-size: 0.9rem; /* Ridotto per mobile */
      cursor: pointer;
    }
    .option:hover {
      background: var(--option-hover-bg);
      transform: translateY(-2px); /* Ridotto per mobile */
    }
    .option label {
      display: flex;
      align-items: center;
      flex: 1;
      font-size: 0.9rem; /* Ridotto per mobile */
      color: var(--text-color);
      cursor: pointer;
      word-wrap: break-word;
    }
    .option input {
      transform: scale(1.2); /* Ridotto per mobile */
      margin-right: 10px; /* Ridotto per mobile */
      cursor: pointer;
    }

    /* Immagini delle Spa in Cerchio */
    .spa-image-small {
      width: 25px; /* Ridotto per mobile */
      height: 25px; /* Ridotto per mobile */
      border-radius: 50%;
      object-fit: cover;
      margin-right: 8px; /* Ridotto per mobile */
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    /* Pulsanti navigazione */
    .navigation-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 15px; /* Ridotto per mobile */
      width: 100%;
    }
    .navigation-buttons button {
      background-color: var(--button-color);
      color: white;
      padding: 8px 16px; /* Ridotto per mobile */
      font-size: 0.8rem; /* Ridotto per mobile */
      border: none;
      border-radius: 20px; /* Ridotto per mobile */
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      flex: 1; /* Permette ai pulsanti di espandersi uniformemente */
      margin: 0 5px; /* Aggiunto spazio tra i pulsanti */
    }
    .navigation-buttons button:first-child {
      margin-left: 0;
    }
    .navigation-buttons button:last-child {
      margin-right: 0;
    }
    .navigation-buttons button:hover {
      background-color: var(--button-hover-color);
      transform: scale(1.02); /* Ridotto per mobile */
    }

    /* Piccola animazione di fadeIn */
    @keyframes fadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }

    /* Responsive Design */
    @media (max-width: 600px) {
      /* Rimossi gli stili specifici per la griglia, ora gestiti globalmente */
      .time-slots {
        /* Nessuna modifica specifica per mobile */
      }
      /* Rimangono gli altri stili già definiti */
    }

    /* Disposizione a due colonne per le mini fasce orarie */
    .time-slots {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .time-slot-button {
      width: 100%;
      box-sizing: border-box;
    }

    /* Stili per il logo */
    .logo-container {
      margin-top: 20px; /* Ridotto */
      text-align: center;
    }

    .logo {
      max-width: 120px; /* Ridotto */
      height: auto;
    }

    /* Prevenzione dello zoom quando si interagisce con gli input */
    input, textarea, select, button {
      font-size: 16px;
    }

    /* Stili per il popup */
    .modal {
      display: none; /* Hidden by default */
      position: fixed;
      z-index: 5000; /* Above loading overlay */
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: hidden; /* Disable scroll */
      background-color: var(--modal-bg); /* Black w/ opacity */
    }

    .modal-content {
      background-color: #fefefe;
      margin: 20% auto; /* Ridotto */
      padding: 15px; /* Ridotto */
      border: 1px solid #888;
      width: 90%;
      max-width: 300px; /* Ridotto */
      border-radius: 10px; /* Ridotto */
      text-align: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      position: relative;
    }

    .close-modal {
      color: #aaa;
      position: absolute;
      top: 8px; /* Ridotto */
      right: 12px; /* Ridotto */
      font-size: 1.2rem; /* Ridotto */
      font-weight: bold;
      cursor: pointer;
    }

    .close-modal:hover,
    .close-modal:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    /* Stili per le immagini delle spa */
    .spa-image-container {
      margin-top: 15px; /* Ridotto */
      text-align: center;
    }

    .spa-image {
      max-width: 100%;
      height: auto;
      border-radius: 8px; /* Ridotto */
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      display: none; /* Initially hidden */
      margin-top: 10px; /* Ridotto */
    }

    /* Stili per l'overlay di caricamento */
    .loading-overlay {
      display: none; /* Hidden by default */
      position: fixed; /* Fisso alla viewport */
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255,255,255,0.8);
      justify-content: center;
      align-items: center;
      border-radius: 10px; /* Ridotto */
      z-index: 4000; /* Above the step content */
    }

    .spinner {
      border: 6px solid #f3f3f3; /* Light grey */
      border-top: 6px solid var(--spinner-color); /* Marrone scuro */
      border-radius: 50%;
      width: 40px; /* Ridotto */
      height: 40px; /* Ridotto */
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Stili per i pulsanti di selezione numero di persone */
    .person-selection {
      display: flex;
      justify-content: space-around;
      margin-top: 10px;
      gap: 10px;
    }
    .person-button {
      flex: 1;
      padding: 10px;
      background-color: var(--button-color);
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      font-size: 0.9rem;
    }
    .person-button.selected,
    .person-button:hover {
      background-color: var(--button-hover-color);
      transform: scale(1.05);
    }

    /* Stili per le mini fasce orarie */
    .time-slot-button {
      padding: 10px;
      background-color: var(--button-color);
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      font-size: 0.9rem;
      width: 100%;
      box-sizing: border-box;
    }
    .time-slot-button.selected,
    .time-slot-button:hover {
      background-color: var(--button-hover-color);
      transform: scale(1.05);
    }

  </style>
</head>

<body>
  <!-- Barra con il totale -->
  <div class="price-bar">
    Totale: <span id="totalPrice">0</span>€
  </div>

  <div class="container">
    <div>
      <h1>Pacchetto Wellness</h1>
      <p>Scegli le opzioni per il tuo relax presso il Trilussa Palace Hotel:</p>

      <form
        id="wellnessForm"
        action="https://script.google.com/macros/s/AKfycbxytaalqXiGvZr2ZneImOD1Os6llLJ-K4hssNHpVw4X_p15xD_rf7bogK2o5GVQcpYYkg/exec" 
        method="POST"
        target="hiddenFrame"
      >
        <!-- STEP 1: Scegli la Spa -->
        <div class="step active" id="step-1">
          <div class="step-header">
            <h2>1. Scegli la Spa</h2>
          </div>
          <div class="options">
            <div class="option">
              <img src="https://www.trilussapalacehotel.it/data/2560/Hotel-Trilussa-Palace-spa-maya-5456-HDR.jpg" alt="SPA MAYA" class="spa-image-small" />
              <label for="spa-maya">
                <input
                  type="radio"
                  id="spa-maya"
                  name="spa"
                  class="option-radio"
                  data-price="0"
                  value="SPA MAYA"
                  required
                />
                SPA MAYA
              </label>
            </div>
            <div class="option">
              <img src="https://www.trilussapalacehotel.it/data/2560/Hotel-Trilussa-Palace-spa-moon-3559.jpg" alt="SPA MOON" class="spa-image-small" />
              <label for="spa-moon">
                <input
                  type="radio"
                  id="spa-moon"
                  name="spa"
                  class="option-radio"
                  data-price="0"
                  value="SPA MOON"
                  required
                />
                SPA MOON
              </label>
            </div>
            <div class="option">
              <img src="https://www.trilussapalacehotel.it/data/2560/Hotel-Trilussa-Palace-spa-domus-63.jpg" alt="SPA DOMUS" class="spa-image-small" />
              <label for="spa-domus">
                <input
                  type="radio"
                  id="spa-domus"
                  name="spa"
                  class="option-radio"
                  data-price="0"
                  value="SPA DOMUS"
                  required
                />
                SPA DOMUS
              </label>
            </div>
          </div>
          <!-- Pulsanti di navigazione -->
          <div class="navigation-buttons">
            <div></div> <!-- Spazio vuoto per allineamento -->
            <button type="button" onclick="showNextStep(1)">Avanti</button>
          </div>
        </div>

        <!-- STEP 2: Scegli la Fascia Oraria -->
        <div class="step" id="step-2">
          <div class="step-header">
            <h2>2. Scegli la Fascia Oraria</h2>
          </div>
          <div class="options">
            <div class="option">
              <label for="time-mattina">
                <input
                  type="radio"
                  id="time-mattina"
                  name="time"
                  class="option-radio"
                  data-price="0"
                  value="MATTINA (08:00-16:00)"
                  required
                />
                MATTINA (08:00-16:00)
              </label>
            </div>
            <div class="option">
              <label for="time-pomeriggio">
                <input
                  type="radio"
                  id="time-pomeriggio"
                  name="time"
                  class="option-radio"
                  data-price="0"
                  value="POMERIGGIO (16:00-23:00)"
                  required
                />
                POMERIGGIO (16:00-23:00)
              </label>
            </div>
            <div class="option">
              <label for="time-notte">
                <input
                  type="radio"
                  id="time-notte"
                  name="time"
                  class="option-radio"
                  data-price="0"
                  value="NOTTE (23:00-08:00)"
                  required
                />
                NOTTE (23:00-08:00)
              </label>
            </div>
          </div>
          <div class="navigation-buttons">
            <button type="button" onclick="showPreviousStep(2)">Indietro</button>
            <button type="button" onclick="showNextStep(2)">Avanti</button>
          </div>
        </div>

        <!-- STEP 3: Scegli il Numero di Persone -->
        <div class="step" id="step-3">
          <div class="step-header">
            <h2>3. Scegli il Numero di Persone</h2>
          </div>
          <div class="person-selection">
            <button type="button" class="person-button selected" data-value="2">2 Persone</button>
            <button type="button" class="person-button" data-value="3">3 Persone</button>
            <button type="button" class="person-button" data-value="4">4 Persone</button>
          </div>
          <!-- Campo nascosto per il numero di persone -->
          <input type="hidden" name="persons" id="selectedPersons" value="2" />
          <!-- Pulsanti di navigazione -->
          <div class="navigation-buttons">
            <button type="button" onclick="showPreviousStep(3)">Indietro</button>
            <button type="button" onclick="showNextStep(3)">Avanti</button>
          </div>
        </div>

        <!-- STEP 4: Scegli la Durata -->
        <div class="step" id="step-4">
          <div class="step-header">
            <h2>4. Scegli la Durata</h2>
          </div>
          <div class="options">
            <div class="option">
              <label for="duration-1h">
                <input
                  type="radio"
                  id="duration-1h"
                  name="duration"
                  class="option-radio"
                  data-price="0"
                  value="1h"
                  required
                />
                1 Ora
              </label>
            </div>
            <div class="option">
              <label for="duration-1.30h">
                <input
                  type="radio"
                  id="duration-1.30h"
                  name="duration"
                  class="option-radio"
                  data-price="0"
                  value="1.30h"
                  required
                />
                1.30 Ore
              </label>
            </div>
          </div>
          <!-- Pulsanti di navigazione -->
          <div class="navigation-buttons">
            <button type="button" onclick="showPreviousStep(4)">Indietro</button>
            <button type="button" onclick="showNextStep(4)">Avanti</button>
          </div>
        </div>

        <!-- STEP 5: Scegli le Mini Fasce Orarie -->
        <div class="step" id="step-5">
          <div class="step-header">
            <h2>5. Scegli le Mini Fasce Orarie</h2>
          </div>
          <div class="time-slots" id="timeSlotsContainer">
            <!-- Le opzioni verranno generate dinamicamente tramite JavaScript -->
          </div>
          <!-- Pulsanti di navigazione -->
          <div class="navigation-buttons">
            <button type="button" onclick="showPreviousStep(5)">Indietro</button>
            <button type="button" onclick="showNextStep(5)">Avanti</button>
          </div>
        </div>

        <!-- STEP 6: Scegli gli Extra -->
        <div class="step" id="step-6">
          <div class="step-header">
            <h2>6. Scegli gli Extra</h2>
          </div>
          <div class="extras">
            <div class="option">
              <label for="extra-cena">
                <input
                  type="checkbox"
                  id="extra-cena"
                  class="option-checkbox"
                  data-price="90"
                  name="extras"
                  value="Cena RAMO Bistrot"
                />
                Cena RAMO Bistrot - €90
              </label>
            </div>
            <div class="option">
              <label for="extra-sushi">
                <input
                  type="checkbox"
                  id="extra-sushi"
                  class="option-checkbox"
                  data-price="35"
                  name="extras"
                  value="Sushi Misto"
                />
                Sushi Misto - €35
              </label>
            </div>
            <div class="option">
              <label for="extra-pinsa">
                <input
                  type="checkbox"
                  id="extra-pinsa"
                  class="option-checkbox"
                  data-price="20"
                  name="extras"
                  value="Pinsa"
                />
                Pinsa - €20
              </label>
            </div>
            <div class="option">
              <label for="extra-prosecco">
                <input
                  type="checkbox"
                  id="extra-prosecco"
                  class="option-checkbox"
                  data-price="40"
                  name="extras"
                  value="Bottiglia di Prosecco"
                />
                Bottiglia di Prosecco - €40
              </label>
            </div>
          </div>
          <div class="navigation-buttons">
            <button type="button" onclick="showPreviousStep(6)">Indietro</button>
            <button type="button" onclick="showNextStep(6)">Avanti</button>
          </div>
        </div>

        <!-- STEP 7: Conferma e invio -->
        <div class="step" id="step-7">
          <div class="step-header">
            <h2>7. Conferma e Richiesta Preventivo</h2>
          </div>
          <div class="section">
            <label for="email" style="font-weight:bold; font-size: 0.9rem;">Email *</label>
            <input
              type="email"
              name="email"
              id="email"
              placeholder="La tua Email"
              required
              style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid var(--input-border-color); margin-bottom: 10px; font-size: 0.9rem;"
            />

            <label for="phone" style="font-weight:bold; font-size: 0.9rem;">Telefono *</label>
            <input
              type="tel"
              name="phone"
              id="phone"
              placeholder="Il tuo Telefono"
              required
              pattern="^[0-9]{10,15}$"
              title="Inserisci un numero di telefono valido (10-15 cifre)."
              style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid var(--input-border-color); margin-bottom: 10px; font-size: 0.9rem;"
            />

            <input type="hidden" name="total" id="total" />
          </div>
          <!-- Overlay di caricamento posizionato sopra l'intera pagina -->
          <div id="loadingOverlay" class="loading-overlay">
            <div class="spinner"></div>
          </div>
          <div class="navigation-buttons">
            <button type="button" onclick="showPreviousStep(7)">Indietro</button>
            <button type="submit">Richiedi Conferma</button>
          </div>
        </div>
      </form>

      <!-- Logo -->
      <div class="logo-container">
        <img src="https://www.trilussasparoma.com/data/png/logo_global.png" alt="Trilussa Palace Hotel Logo" class="logo" />
      </div>

      <!-- Iframe nascosto per l'invio del form con onload -->
      <iframe name="hiddenFrame" style="display:none;" onload="onFormLoad()"></iframe>

      <!-- Popup di conferma -->
      <div id="confirmationModal" class="modal">
        <div class="modal-content">
          <span class="close-modal" onclick="closeModal()">&times;</span>
          <h2>Richiesta Inviata!</h2>
          <p>Grazie! La tua richiesta è stata inviata con successo.</p>
          <button onclick="closeModal()">Chiudi</button>
        </div>
      </div>

    </div>

    <script>
      let currentStep = 1;
      const totalSteps = 7;

      function showStep(step) {
        for (let i = 1; i <= totalSteps; i++) {
          const stepElement = document.getElementById(`step-${i}`);
          if (i === step) {
            stepElement.classList.add("active");
          } else {
            stepElement.classList.remove("active");
          }
        }
      }

      function showNextStep(step) {
        if (!validateStep(step)) return;
        if (step < totalSteps) {
          currentStep = step + 1;
          showStep(currentStep);
          updateTotal();
          if (currentStep === 5) { // Step 5: Scegli le Mini Fasce Orarie
            generateTimeSlots();
          }
        }
      }

      function showPreviousStep(step) {
        if (step > 1) {
          currentStep = step - 1;
          showStep(currentStep);
        }
      }

      // Convalida radio obbligatori negli step 1,2,4,5 e time slots in step 5
      function validateStep(step) {
        let valid = true;
        const stepElement = document.getElementById(`step-${step}`);

        if (step === 1 || step === 2 || step === 4 || step === 5) {
          if (step === 5) {
            const timeSlotSelected = stepElement.querySelectorAll('input[name="timeSlot"]:checked');
            if (timeSlotSelected.length === 0) {
              alert("Per favore, seleziona una mini fascia oraria.");
              valid = false;
            }
          } else {
            const required = stepElement.querySelectorAll('input[type="radio"]:checked');
            if (required.length === 0) {
              alert("Per favore, completa tutte le scelte obbligatorie.");
              valid = false;
            }
          }
        }

        // Per lo step 7, controlla se telefono è inserito (già obbligatorio tramite HTML)
        if (step === 7) {
          const phoneInput = document.getElementById('phone');
          const phoneValue = phoneInput.value.trim();
          const phonePattern = /^[0-9]{10,15}$/;
          if (!phonePattern.test(phoneValue)) {
            alert("Per favore, inserisci un numero di telefono valido (10-15 cifre).");
            valid = false;
          }
        }

        return valid;
      }

      // Calcolo totale
      function updateTotal() {
        let totalPrice = 0;

        const spaSelected = document.querySelector('input[name="spa"]:checked');
        const timeSelected = document.querySelector('input[name="time"]:checked');
        const durationSelected = document.querySelector('input[name="duration"]:checked');
        const timeSlotSelected = document.querySelector('input[name="timeSlot"]:checked');
        const personsSelected = document.getElementById('selectedPersons').value;
        let persons = 2;
        if (personsSelected) {
          persons = parseInt(personsSelected) || 2;
        }

        if (spaSelected && timeSelected && durationSelected && timeSlotSelected) {
          const spaPrices = {
            "SPA MAYA": {
              "MATTINA (08:00-16:00)": { "1h": 110, "1.30h": 160 },
              "POMERIGGIO (16:00-23:00)": { "1h": 170, "1.30h": 360 },
              "NOTTE (23:00-08:00)": { "1h": 250, "1.30h": 360 },
            },
            "SPA MOON": {
              "MATTINA (08:00-16:00)": { "1h": 90, "1.30h": 130 },
              "POMERIGGIO (16:00-23:00)": { "1h": 140, "1.30h": 290 },
              "NOTTE (23:00-08:00)": { "1h": 200, "1.30h": 290 },
            },
            "SPA DOMUS": {
              "MATTINA (08:00-16:00)": { "1h": 75, "1.30h": 110 },
              "POMERIGGIO (16:00-23:00)": { "1h": 110, "1.30h": 220 },
              "NOTTE (23:00-08:00)": { "1h": 160, "1.30h": 220 },
            },
          };

          const spaPrice = spaPrices[spaSelected.value][timeSelected.value][durationSelected.value];
          totalPrice += spaPrice;
        }

        if (persons > 2) {
          totalPrice += (persons - 2) * 30;
        }

        const checkboxes = document.querySelectorAll(".option-checkbox:checked");
        checkboxes.forEach((checkbox) => {
          totalPrice += parseFloat(checkbox.dataset.price);
        });

        document.getElementById("totalPrice").textContent = totalPrice.toFixed(2);
        document.getElementById("total").value = totalPrice.toFixed(2);
      }

      const radioButtons = document.querySelectorAll(".option-radio");
      const checkboxes = document.querySelectorAll(".option-checkbox");
      const personsButtons = document.querySelectorAll(".person-button");

      radioButtons.forEach((radio) => {
        radio.addEventListener("change", () => {
          updateTotal();
          // Se la selezione cambia la fascia oraria o durata, resetta le mini fasce orarie
          if (currentStep >= 5) {
            currentStep = 5;
            showStep(currentStep);
            generateTimeSlots();
          }
        });
      });
      checkboxes.forEach((checkbox) => {
        checkbox.addEventListener("change", updateTotal);
      });

      personsButtons.forEach((button) => {
        button.addEventListener("click", () => {
          // Rimuovi la classe 'selected' da tutti i pulsanti
          personsButtons.forEach(btn => btn.classList.remove('selected'));
          // Aggiungi la classe 'selected' al pulsante cliccato
          button.classList.add('selected');
          // Aggiorna il valore nascosto
          const selectedValue = button.getAttribute('data-value');
          document.getElementById('selectedPersons').value = selectedValue;
          updateTotal();
        });
      });

      // Popup di conferma al termine dell'invio
      function onFormLoad() {
        // Nascondi l'overlay e mostra il popup
        hideLoading();
        openModal();
      }

      // Funzioni per aprire e chiudere il popup
      function openModal() {
        document.getElementById("confirmationModal").style.display = "block";
      }

      function closeModal() {
        document.getElementById("confirmationModal").style.display = "none";
      }

      // Chiudi il modal se l'utente clicca fuori dal contenuto
      window.onclick = function(event) {
        const modal = document.getElementById("confirmationModal");
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }

      // Funzioni per l'overlay di caricamento
      function showLoading() {
        document.getElementById("loadingOverlay").style.display = "flex";
      }

      function hideLoading() {
        document.getElementById("loadingOverlay").style.display = "none";
      }

      // Aggiungi un listener per l'evento submit del modulo
      document.getElementById('wellnessForm').addEventListener('submit', function(event) {
        showLoading();
      });

      // Impedisce lo zoom quando si interagisce con gli input
      document.addEventListener('touchmove', function(event) {
        // Solo se non si sta interagendo con un input
        const activeElement = document.activeElement;
        if (activeElement.tagName !== 'INPUT' && activeElement.tagName !== 'TEXTAREA') {
          event.preventDefault();
        }
      }, { passive: false });

      // Funzione per generare le mini fasce orarie dinamicamente
      function generateTimeSlots() {
        const timeSelected = document.querySelector('input[name="time"]:checked');
        const durationSelected = document.querySelector('input[name="duration"]:checked');
        const container = document.getElementById('timeSlotsContainer');

        // Svuota il contenitore
        container.innerHTML = '';

        if (!timeSelected || !durationSelected) return;

        const time = timeSelected.value;
        const duration = durationSelected.value;

        let slots = [];

        if (time.startsWith('MATTINA')) {
          if (duration === '1h') {
            slots = ["8-9", "10-11", "12-13", "13-14", "15-16"];
          } else if (duration === '1.30h') {
            slots = ["8-9.30", "10-11.30", "12-13.30", "13-14.30", "15-16.30"];
          }
        } else if (time.startsWith('POMERIGGIO')) {
          if (duration === '1h') {
            slots = ["16-17", "17-18", "19-20", "20-21", "21-22"];
          } else if (duration === '1.30h') {
            slots = ["16-17.30", "17-18.30", "19-20.30", "20-21.30", "21-22.30"];
          }
        } else if (time.startsWith('NOTTE')) {
          if (duration === '1h') {
            slots = ["23-24", "24-01", "02-03", "03-04", "05-06", "07-08"];
          } else if (duration === '1.30h') {
            slots = ["23-00.30", "00-01.30", "02-03.30", "03-04.30", "05-06.30", "07-08.30"];
          }
        }

        slots.forEach(slot => {
          const optionDiv = document.createElement('div');
          optionDiv.classList.add('option');

          const label = document.createElement('label');
          label.setAttribute('for', `time-slot-${slot.replace('.', '')}`); // Rimuove il punto per l'ID

          const input = document.createElement('input');
          input.type = 'radio';
          input.id = `time-slot-${slot.replace('.', '')}`;
          input.name = 'timeSlot';
          input.value = slot;
          input.required = true;

          label.appendChild(input);
          label.appendChild(document.createTextNode(` ${formatSlot(slot)}`));

          optionDiv.appendChild(label);
          container.appendChild(optionDiv);
        });

        // Aggiungi listener ai nuovi radio button per aggiornare il totale al cambio
        const newRadioButtons = container.querySelectorAll('input[name="timeSlot"]');
        newRadioButtons.forEach(radio => {
          radio.addEventListener('change', updateTotal);
        });
      }

      // Funzione per formattare gli slot
      function formatSlot(slot) {
        const [start, end] = slot.split('-');
        // Formatta con due cifre per ore e minuti
        const formatTime = (time) => {
          const [hour, minute] = time.split('.');
          return `${padZero(parseInt(hour, 10))}:${minute ? minute.padStart(2, '0') : '00'}`;
        };
        return `${formatTime(start)} - ${formatTime(end)}`;
      }

      // Funzione per aggiungere zero davanti ai numeri minori di 10
      function padZero(number) {
        return number < 10 ? '0' + number : number;
      }

      // Funzione per aggiungere i pulsanti per selezionare il numero di persone
      window.addEventListener('DOMContentLoaded', (event) => {
        // Pulsanti già presenti nel HTML
      });
    </script>
</body>
</html>
